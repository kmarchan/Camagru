<!DOCTYPE html>
<!-- saved from url=(0044)http://localhost:8080/Camagru/image_edit.php -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>Home</title>
        <link rel="stylesheet" type="text/css" href="./Home_files/style.css">
        <style>
            #container {
                object-fit: contain;
                border: 3px;
                align: left;
            }
            #videoElement {
                object-fit: contain;
                /*position: relative;*/
                /*background-color: #666;*/
                /*margin-left: 10%;*/
                /*top: 0;*/
                /*left: 0;*/
                /*margin: auto;*/
            }
            .button, .camera {
                background-color: #EFCE5B;
                border-radius: 100%;
                padding: 10px;
                box-shadow: 10px 5px 10px lightgoldenrodyellow inset;
            }

            .close {
                color: #aaaaaa;
                float: right;
                font-size: 28px;
                font-weight: bold;
            }
            .myCanvas {
                object-fit: contain;
                position: absolute;
                /*margin-left: 20%;*/
                /*top: 0;*/
                /*left: 0;*/
                /*z-index: 10;*/
            }
        </style>

    </head>
    <body>
        <div class="header">
	<h1>Camagru</h1>
	<p align="right"><a href="http://localhost:8080/Camagru/index.php?logout=%271%27" ;="">Log out</a></p><p align="right"><a href="http://localhost:8080/Camagru/account.php">Account Settings</a></p><p align="centre">Welcome <strong>TREDX</strong></p><table>
		<tbody><tr>
			<td>
				<div>
					<a href="http://localhost:8080/Camagru/index.php">Home</a>
				</div>
			</td>
												
							
              
          								
		</tr>
	</tbody></table>
</div>
        <table name="main" width="100%">
            <tbody><tr>
                <td width="75%" valign="top">
                    <div class="content">
                                                                                                <div id="container">

                            <video autoplay="true" id="videoElement" height="500" width="666"></video>
                            
                        <canvas id="myCanvas" class="myCanvas" height="500" width="666"></canvas></div>
                        <br>

                        <button id="upload" type="submit" class="camera" align="centre" title="Save">
                            <a href="http://localhost:8080/Camagru/upload_edit.php"> <img src="./Home_files/upload.png" alt="upload" height="30px"></a>
                        </button>
                        <button type="submit" name="snapshot" onclick="snapshot()" class="camera" align="centre" title="Snapshot">
                            <img src="./Home_files/camera.png" alt="shoot" height="30px">
                        </button>
                    </div>
                </td>
                <td width="25%" valign="top">
                    <div id="side" class="content" height="100%" name="side">
                        <h2>Snapshots</h2>
                        <div id="status"></div>
                        <div class="" id="snp">
                        </div>
                    </div>
                </td>
                <script>
                    // Webcam stream
                    var video = document.querySelector("#videoElement");

                    if (navigator.mediaDevices.getUserMedia)
                    {
                        navigator.mediaDevices.getUserMedia({video: true})
                            .then(function(stream)
                            {
                                video.srcObject = stream;
                                return video.play();
                            })
                    }

                    var width = 0, height = 0;

                    var canvas = document.getElementById('myCanvas'),

                    ctx = canvas.getContext('2d');
                    document.getElementById("container").appendChild(canvas);

                    function snapshot()
                    {
                        var img = document.createElement('img');
                        var context;
                        var width = video.offsetWidth
                            , height = video.offsetHeight;
                        var can;
                        can = document.createElement("canvas");
                        can.width = width;
                        can.height = height;
                        context = can.getContext('2d');
                        context.drawImage(video, 0, 0, width, height);
                        context.drawImage(myCanvas, 0, 0, width, height);
                        img.src = can.toDataURL('image/png');
                        img.setAttribute("height", "100");
                        console.log(img.src);
                        snp.insertBefore(img, snp.firstChild);

                        img.addEventListener("click", save);
                    }

                    function save()
                    {
                      if (confirm("Save Photo?"))
                      {
                          var xhr = new XMLHttpRequest();
                          var url = "server.php";
                          var usr = 'TREDX'
                          var pic = (encodeURIComponent(JSON.stringify(this.src)));
                          var vars = "username="+usr+"&pic="+pic+"&save=true";
                          console.log (vars);
                          xhr.open("POST", url, true);
                          xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                          xhr.onreadystatechange = function()
                          {
                              if (xhr.readyState == 4 && xhr.status == 200)
                              {
                                  var return_data = xhr.responseText;
                                  document.getElementById("status").innerHTML = return_data;
                              }
                          }
                      }
                      xhr.send(vars);
                      document.getElementById("status").innerHTML = "testing";
                    }

                </script>
            </tr>
        </tbody></table>
        <div class="header">
            <img height="100" src="./Home_files/branches.png" alt="branches" onclick="addSticker(&#39;./stickers/branches.png&#39;)" value="Add">
            <img height="100" src="./Home_files/bullets.png" alt="bullets" onclick="addSticker(&#39;./stickers/bullets.png&#39;)" value="Add">
            <img height="100" src="./Home_files/butterfly.png" alt="butterfly" onclick="addSticker(&#39;./stickers/butterfly.png&#39;)" value="Add">
            <img height="100" src="./Home_files/Gorgosaurus.png" alt="dino" onclick="addSticker(&#39;./stickers/Gorgosaurus.png&#39;)" value="Add">
            <img height="100" src="./Home_files/water.png" alt="water" onclick="addSticker(&#39;./stickers/water.png&#39;)" value="Add">
            <script>
            function addSticker(loc)
            {
                var canvas = document.getElementById("myCanvas");
                var ctx = canvas.getContext("2d");

                var img = new Image();
                img.src = loc;

                console.log(loc);

                var hRatio = img.width / canvas.width ;
                var vRatio = img.height / canvas.height ;
                var ratio  = Math.min ( hRatio, vRatio );

                ctx.drawImage(img, 0,0, canvas.width, canvas.height);
            }
            </script>
        </div>
    

</body></html>